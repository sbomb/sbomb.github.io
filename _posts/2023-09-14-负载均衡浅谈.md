---
layout: post
title:  "负载均衡浅谈"
description: 负载均衡
tag: [负载均衡,网络转发,网络流量,七层负载,四层负载,zf520,java思录]
date:   2023-09-14 11:58:00 +0800
categories: 负载均衡
author: ZF520
---
# 摘要
负载均衡是计算机网络中的一种技术，主要目的是将网络中的流量转发（或复制）到多台计算机上，以达到系统的高性能和可靠性。也可以用来做流量灰度测试等等。负载均衡可以应用与各种网络应用中，如web服务器、数据库服务器、文件服务器等。

# 正文
负载均衡是现在网络或者各高负载、高可用的系统中常用的一种技术，主要是将网络流量转发（或复制）到多台计算机上。以达到系统或者承载的高可用、高可靠的要求。同时，也可用在将部分机器暴露到互联网上，而保护处于局域网中的大多数机器。

负载均衡主要是通过硬件设备或软件来实现。硬件设备通常是专用的网络设备，如负载均衡器、交换机、F5等。软件实现则是在计算机上安装负载均衡软件，如Apache、Nginx、Haproxy、LVS、iptables等软件。

负载均衡的优势在于把流量转发到系统中的多台机器上，从而避免单台机器的单点故障，把压力分散到集群中，减少单台机器故障带来的问题。

### 应用场景

- 负载均衡：把网络流量转发到集群中，共同承担网络压力、CPU压力以及性能提升。
- 反向代理：通过提供负载均衡器，减少暴露在互联网上的机器的数量，通过负载均衡器，把所接收的流量通过负载均衡策略转发到内部的局域网集群中。增加网络安全，减少由于机器漏洞带来的风险。
- 流量复制：通过负载均衡器，把网络流量复制一份到测试环境或者复制到另一环境中，从而对流量产生的功能和系统进行测试。
- 流量分发：通过负载均衡器，实现网络流量的分发，根据A\B流量测试，把一部分流量分发到新的系统上或者新的业务逻辑上，从而验证功能的可靠性和实用性。

### 负载均衡策略

负载均衡策略主要是轮询、随机、加权、hash等。

- 轮询：根据所有的机器进入队列，从队列中顺序分配给每台机器上。
- 随机：从所有的机器中随机获取一台机器进行访问。
- 加权：根据设定的其他规则，对某台机器进行权重调整，以便让这台机器能根据权重来访问。
- hash：使用hash算法，让符合某个规则的访问者能再次访问。



### 负载均衡原理

负载均衡主要就是把网络流量根据规则进行分发，而在七层网络协议中，可用分发流量的一般在四层和七层（传输层和应用层）。

四层负载是指在网络协议的第四层（传输层）上实现负载均衡。在这一层，负载均衡器会修改网络包中的MAC地址，从而达到网络流量转发的效果。具体来说，当一个网络包到达负载均衡器时，它会根据预先设定的规则，将MAC地址进行重新改写，然后将包转发到目标机器上。这样，负载均衡器就可以将流量转发到多台机器上，从而实现负载均衡的效果。

四层负载的优点是简单易用，可以快速实现负载均衡的效果。但是，由于它只能修改MAC地址，无法根据更多的信息进行转发，因此在处理复杂的应用场景时可能会存在一些问题。例如，在处理HTTP请求时，无法根据请求的内容进行转发，只能根据IP地址进行转发，这可能会导致一些问题。

七层负载是指在网络协议的第七层（应用层）上实现负载均衡。在这一层，负载均衡器可以根据更多的信息进行转发，例如请求的地址、请求的HTTP请求头等等。这样，负载均衡器就可以根据更多的信息进行转发，从而实现更加精细的负载均衡效果。

常用的负载均衡软例如nginx、apache和Haproxy等负载均衡软件，一般都工作在应用层。

